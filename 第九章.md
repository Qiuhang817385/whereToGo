![image-20200512010401488](C:/Users/Artificial/AppData/Roaming/Typora/typora-user-images/image-20200512010401488.png)

## url参数解析和数据请求

![image-20200512135747913](C:/Users/Artificial/AppData/Roaming/Typora/typora-user-images/image-20200512135747913.png)









## 综合筛选图层







## 数据联动

![image-20200512214736657](C:/Users/Artificial/AppData/Roaming/Typora/typora-user-images/image-20200512214736657.png)



只看来修改掉车次类型

```js
case ACTION_SET_CHECKED_TRAIN_TYPES:
      console.log('payload', payload);
      const checkedTrainTypes = payload;
      let newHighSpeed = state.highSpeed;
      if (Boolean(checkedTrainTypes[1] && checkedTrainTypes[5])) {
        newHighSpeed = true;
      }
      return { ...state, checkedTrainTypes: payload, highSpeed: newHighSpeed }




case ACTION_SET_HIGH_SPEED:
      console.log('state', state)
      const newCheckedTrainTypes = state.checkedTrainTypes;
      // let newisFiltersVisible = state.isFiltersVisible;
      // console.log('newisFiltersVisible', newisFiltersVisible)
      if (payload) {
        // newisFiltersVisible = true;
        newCheckedTrainTypes[1] = true;
        newCheckedTrainTypes[5] = true;
      } else {
        // newisFiltersVisible = false;
        delete newCheckedTrainTypes[1]
        delete newCheckedTrainTypes[5]
      }
      // console.log('payload', payload)
      // , isFiltersVisible: newisFiltersVisible 这里没有实现联动
      return { ...state, highSpeed: payload, checkedTrainTypes: newCheckedTrainTypes }
```



## 重置

对于重置按钮，由于最小颗粒组件已经无法感知到上层数据的存在，更新的时候通过修改每一项来更新？



为什么不能追踪到重置这一操作，

因为重置是在浮层第一层

缓存的数据在第二层



最小颗粒可以修改第二层的，但是第一层的修改第二层的缓存  就不太好了

当然也可以我觉得

不能，第二存的缓存数据，是定义在toggle当中的





这个场景使用useReducer来定义缓存数据，用reducer来定义store层面的数据

useReducer是组件state层面的



现在把toggle从option当中去除



useReducer当作局部的redux

useReducer内部就是对useState的封装



useReducer能做的事情，useState一样可以





## 类似于component will recive props

![image-20200513003128848](C:/Users/Artificial/AppData/Roaming/Typora/typora-user-images/image-20200513003128848.png)





![image-20200513003810622](C:/Users/Artificial/AppData/Roaming/Typora/typora-user-images/image-20200513003810622.png)





## 一个Bug

```js
// 这里不能使用useMemo
  // 因为对象没有变,里面变了,检测不到
  const noChecked = /* useMemo(() => { */
    /* return */ Object.keys(checkedTicketTypes).length === 0
    && Object.keys(checkedTrainTypes).length === 0
    && Object.keys(checkedDepartStations).length === 0
    && Object.keys(checkedArriveStations).length === 0
    && departTimeStart === 0
    && departTimeEnd === 24
    && arriveTimeStart === 0
    && arriveTimeEnd === 24
  /* }, [checkedTicketTypes,
    checkedTrainTypes,
    checkedDepartStations,
    checkedArriveStations,
    departTimeStart,
    departTimeEnd,
    arriveTimeStart,
    arriveTimeEnd,]) */;

```













## redux

p7里看到很多人说：store的state都改变了，技术胖为啥还说没改变。这是因为即使是store里数据发生了变化，但是由于之前store.getState()执行已经是过去时了，那么会造成视图层的state并没有更新。所以，redux为各位准备了一个监听函数，即每当store里的state发生变化就会执行store.subscribe的回调。



BV1w441137ss

